generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id                Int                  @id @default(autoincrement())
  nome              String
  email             String               @unique
  senha             String
  role              UserRole             @default(MEDICO)
  crm               String?              @unique
  especialidade     String?
  criadoEm          DateTime             @default(now())
  agendasCriadas    Agenda[]             @relation("AgendamentoCriadoPor")
  agendasAtendidas  Agenda[]             @relation("AgendamentoMedico")
  escalas           EscalaTrabalho[]
  observacoesFeitas ConsultaObservacao[]
}

model Paciente {
  id         Int      @id @default(autoincrement())
  nome       String
  cpf        String   @unique
  nascimento DateTime
  telefone   String?
  endereco   String?
  email      String?
  agendas    Agenda[]
}

model Agenda {
  id                  Int                  @id @default(autoincrement())
  pacienteId          Int
  medicoId            Int
  data                DateTime
  tipoConsulta        String
  status              StatusAgenda         @default(Agendado)
  criadoPor           Int
  criadoEm            DateTime             @default(now())
  criador             User                 @relation("AgendamentoCriadoPor", fields: [criadoPor], references: [id])
  medico              User                 @relation("AgendamentoMedico", fields: [medicoId], references: [id])
  paciente            Paciente             @relation(fields: [pacienteId], references: [id])
  observacoesConsulta ConsultaObservacao[]
}

model EscalaTrabalho {
  id              Int     @id @default(autoincrement())
  medicoId        Int
  diaSemana       Int
  horaInicio      String
  horaFim         String
  duracaoConsulta Int     @default(30)
  ativo           Boolean @default(true)
  medico          User    @relation(fields: [medicoId], references: [id])

  @@index([medicoId, diaSemana])
}

model Session {
  id        String   @id @default(cuid())
  sid       String   @unique
  data      String
  expiresAt DateTime
}

model ConsultaObservacao {
  id           Int      @id @default(autoincrement())
  agendaId     Int
  medicoId     Int
  observacao   String
  dataRegistro DateTime @default(now())
  agenda       Agenda   @relation(fields: [agendaId], references: [id])
  medico       User     @relation(fields: [medicoId], references: [id])

  @@map("ConsultaObservacao")
}

enum UserRole {
  MEDICO
  ADMIN
  RECEPCIONISTA
}

enum StatusAgenda {
  Agendado
  Confirmado
  Atendido
  Cancelado
  Faltou
}
